From a838e4f764f50a8665a147dc678b67a2ebf5813b Mon Sep 17 00:00:00 2001
From: Andoni Morales Alastruey <ylatuya@gmail.com>
Date: Mon, 13 Jan 2014 10:39:47 +0100
Subject: [PATCH 5/5] Fix build of gtk-update-icon-cache in Windows

---
 gtk/Makefile.am | 6 ++++++
 gtk/Makefile.in | 8 ++++++--
 2 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/gtk/Makefile.am b/gtk/Makefile.am
index 1b2afc5..a75cf25 100644
--- a/gtk/Makefile.am
+++ b/gtk/Makefile.am
@@ -1075,6 +1075,7 @@ $(GTK_UPDATE_ICON_CACHE_MANIFEST):
 	 echo '       </security>' ; \
 	 echo '  </trustInfo>' ; \
 	 echo '</assembly>' ) >$@
+	mkdir -p .libs && cp $@ .libs/
 
 $(GTK_UPDATE_ICON_CACHE_RC):
 	(echo 'CREATEPROCESS_MANIFEST_RESOURCE_ID RT_MANIFEST '$(GTK_UPDATE_ICON_CACHE_MANIFEST)) >$@
@@ -1395,9 +1396,14 @@ stamp-icons: $(STOCK_ICONS)
 if CROSS_COMPILING
 gtk_update_icon_cache_program = $(GTK_UPDATE_ICON_CACHE)
 else
+if OS_WIN32
+gtk_update_icon_cache_program = \
+	   .libs/gtk-update-icon-cache
+else
 gtk_update_icon_cache_program =							\
 	   ./gtk-update-icon-cache
 endif
+endif
 
 gtkbuiltincache.h: @REBUILD@ stamp-icons
 	$(MAKE) $(AM_MAKEFLAGS) gtk-update-icon-cache$(EXEEXT)
diff --git a/gtk/Makefile.in b/gtk/Makefile.in
index 57b3be8..d4b2267 100644
--- a/gtk/Makefile.in
+++ b/gtk/Makefile.in
@@ -2172,8 +2172,11 @@ GENERATED_ICONS = \
 	stock-icons/24/user-home.png 			\
 	stock-icons/24/user-desktop.png
 
-@CROSS_COMPILING_FALSE@gtk_update_icon_cache_program = \
-@CROSS_COMPILING_FALSE@	   ./gtk-update-icon-cache
+@CROSS_COMPILING_FALSE@@OS_WIN32_FALSE@gtk_update_icon_cache_program = \
+@CROSS_COMPILING_FALSE@@OS_WIN32_FALSE@	   ./gtk-update-icon-cache
+
+@CROSS_COMPILING_FALSE@@OS_WIN32_TRUE@gtk_update_icon_cache_program = \
+@CROSS_COMPILING_FALSE@@OS_WIN32_TRUE@	   .libs/gtk-update-icon-cache
 
 @CROSS_COMPILING_TRUE@gtk_update_icon_cache_program = $(GTK_UPDATE_ICON_CACHE)
 all: $(BUILT_SOURCES)
@@ -5658,6 +5661,7 @@ distclean-local:
 @OS_WIN32_TRUE@	 echo '       </security>' ; \
 @OS_WIN32_TRUE@	 echo '  </trustInfo>' ; \
 @OS_WIN32_TRUE@	 echo '</assembly>' ) >$@
+@OS_WIN32_TRUE@	mkdir -p .libs && cp $@ .libs/
 
 @OS_WIN32_TRUE@$(GTK_UPDATE_ICON_CACHE_RC):
 @OS_WIN32_TRUE@	(echo 'CREATEPROCESS_MANIFEST_RESOURCE_ID RT_MANIFEST '$(GTK_UPDATE_ICON_CACHE_MANIFEST)) >$@
-- 
2.5.4 (Apple Git-61)

