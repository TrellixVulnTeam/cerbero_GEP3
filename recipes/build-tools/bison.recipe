# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python
import shutil

class Recipe(recipe.Recipe):
    name = 'bison'
    version = '3.0.4'
    licenses = [License.GPLv2Plus]
    stype = SourceType.TARBALL
    url = 'gnu://'
    tarball_checksum = 'a72428c7917bdf9fa93cb8181c971b6e22834125848cf1d03ce10b1bb0716fe1'

    patches = ['bison/0001-Fix-build-invalid-instruction-on-macOS-10.3.patch']

    # Seems bison is storing in the binary references to where to find the .m4
    # Fridge only relocates text-like files, not binaries. Don't allow freezing
    # this recipe for now until we figure out how to sort it out.
    allow_package_creation = False

    files_bins = ['bison', 'yacc']
    files_share = [
        'share/aclocal/bison-i18n.m4',
        'share/bison/README',
        'share/bison/bison.m4',
        'share/bison/c++-skel.m4',
        'share/bison/c++.m4',
        'share/bison/c-like.m4',
        'share/bison/c-skel.m4',
        'share/bison/c.m4',
        'share/bison/glr.c',
        'share/bison/glr.cc',
        'share/bison/java-skel.m4',
        'share/bison/java.m4',
        'share/bison/lalr1.cc',
        'share/bison/lalr1.java',
        'share/bison/location.cc',
        'share/bison/m4sugar/foreach.m4',
        'share/bison/m4sugar/m4sugar.m4',
        'share/bison/stack.hh',
        'share/bison/variant.hh',
        'share/bison/xslt/bison.xsl',
        'share/bison/xslt/xml2dot.xsl',
        'share/bison/xslt/xml2text.xsl',
        'share/bison/xslt/xml2xhtml.xsl',
        'share/bison/yacc.c',
    ]
    def extract(self):
        if os.path.exists(self.build_dir):
            shutil.rmtree(self.build_dir)
        super(recipe.Recipe, self).extract()
