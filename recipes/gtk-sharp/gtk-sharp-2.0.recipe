# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python
import shutil
import os

class Recipe(recipe.Recipe):
    name = 'gtk-sharp'
    version = '2.12.42'
    licenses = [License.LGPL]
    stype = SourceType.TARBALL
    deps = ['gtk+', 'libglade', 'mono']
    url = 'https://github.com/mono/gtk-sharp/archive/2.12.42.tar.gz'
    config_sh = 'sh bootstrap-2.12'

    files_gapi = [
        'lib/gtk-sharp-2.0/gapi_codegen.exe',
        'lib/gtk-sharp-2.0/gapi-parser.exe',
        'lib/gtk-sharp-2.0/gapi-fixup.exe'
    ]

    platform_files_gapi = {
        Platform.LINUX: [
            'bin/gapi2-parser',
            'bin/gapi2-fixup',
            'bin/gapi2-codegen',
            'lib/gtk-sharp-2.0/gapi2xml.pl',
            'lib/gtk-sharp-2.0/gapi_pp.pl',
        ],
        Platform.DARWIN: [
            'bin/gapi2-parser',
            'bin/gapi2-fixup',
            'bin/gapi2-codegen',
            'lib/gtk-sharp-2.0/gapi2xml.pl',
            'lib/gtk-sharp-2.0/gapi_pp.pl',
        ]
    }

    # When cross compiling on Windows the glue files
    # are not installed on bin (not the %(sdir) var)
    files_glue = [
        'lib/libatksharpglue-2%(mext)s',
        'lib/libgdksharpglue-2%(mext)s',
        'lib/libglibsharpglue-2%(mext)s',
        'lib/libgtksharpglue-2%(mext)s',
        'lib/libpangosharpglue-2%(mext)s',
        'lib/libgladesharpglue-2%(mext)s',
    ]

    files_mono = [
        'lib/mono/gtk-sharp-2.0/atk-sharp.dll',
        'lib/mono/gtk-sharp-2.0/gtk-sharp.dll',
        'lib/mono/gtk-sharp-2.0/gdk-sharp.dll',
        'lib/mono/gtk-sharp-2.0/pango-sharp.dll',
        'lib/mono/gtk-sharp-2.0/glib-sharp.dll',
        'lib/mono/gtk-sharp-2.0/glade-sharp.dll',
        'lib/mono/gtk-sharp-2.0/atk-sharp.dll.config',
        'lib/mono/gtk-sharp-2.0/gtk-sharp.dll.config',
        'lib/mono/gtk-sharp-2.0/gdk-sharp.dll.config',
        'lib/mono/gtk-sharp-2.0/pango-sharp.dll.config',
        'lib/mono/gtk-sharp-2.0/glib-sharp.dll.config',
        'lib/mono/gtk-sharp-2.0/glade-sharp.dll.config',
       ]

    files_devel = [
        'lib/pkgconfig/glade-sharp-2.0.pc',
        'lib/pkgconfig/glib-sharp-2.0.pc',
        'lib/pkgconfig/gtk-sharp-2.0.pc',
        'lib/pkgconfig/gapi-2.0.pc',
    ]

    def prepare(self):
        if self.config.target_platform == Platform.WINDOWS:
            raise InvalidRecipeError()

    def post_install(self):
        for x in ['atk', 'gtk', 'gdk', 'pango', 'glib', 'glade']:
            os.remove(os.path.join(self.config.prefix, 'lib', 'mono', 'gtk-sharp-2.0', "%s-sharp.dll" % x))
            shutil.copy(os.path.join(self.build_dir, x, "%s-sharp.dll" % x),
                       os.path.join(self.config.prefix, 'lib', 'mono', 'gtk-sharp-2.0'))
            shutil.copy(os.path.join(self.build_dir, x, "%s-sharp.dll.config" % x),
                       os.path.join(self.config.prefix, 'lib', 'mono', 'gtk-sharp-2.0'))
